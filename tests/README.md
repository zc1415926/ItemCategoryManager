# Electron 自动化测试详解

## 测试环境

- **测试框架**: Playwright
- **测试对象**: Electron 应用
- **测试语言**: JavaScript (Node.js)

## 测试用例详解

### 1. 新建文件按钮
**目的**: 测试"新建"按钮功能
**步骤**:
- 点击"新建"按钮
- 检查条目容器是否清空
**预期结果**: 所有条目和分类被清空

### 2. 添加条目
**目的**: 测试添加单个条目功能
**步骤**:
- 在输入框中输入"测试条目1"
- 点击"添加条目"按钮
- 检查条目是否添加成功
**预期结果**: 条目列表中包含新添加的条目

### 3. 添加多个条目
**目的**: 测试批量添加条目功能
**步骤**:
- 循环添加多个条目（条目2、条目3、条目4）
- 检查总条目数
**预期结果**: 条目列表中包含所有添加的条目

### 4. 创建分类
**目的**: 测试创建新分类功能
**步骤**:
- 点击"添加分类"按钮
- 在模态框中输入分类名称"测试分类"
- 点击确认按钮
- 检查分类是否创建成功
**预期结果**: 分类列表中包含新创建的分类

### 5. 拖放条目到分类
**目的**: 测试拖拽功能
**步骤**:
- 获取第一个条目
- 获取第一个分类
- 执行拖放操作
- 检查条目是否移动到分类中
**预期结果**: 条目成功移动到分类中

### 6. 搜索功能
**目的**: 测试搜索高亮功能
**步骤**:
- 添加包含"123"的测试条目
- 在搜索框中输入"123"
- 检查是否找到搜索高亮
**预期结果**: 匹配的文字被高亮显示

### 7. 清除搜索
**目的**: 测试清除搜索结果功能
**步骤**:
- 清空搜索框
- 检查高亮是否清除
**预期结果**: 所有高亮被清除

### 8. 编辑条目
**目的**: 测试编辑条目功能
**步骤**:
- 点击第一个条目的编辑按钮
- 在模态框中修改条目内容
- 点击确认按钮
- 检查条目是否已更新
**预期结果**: 条目内容成功更新

### 9. 删除条目
**目的**: 测试删除条目功能
**步骤**:
- 记录删除前的条目数
- 点击第一个条目的删除按钮
- 在确认对话框中点击确认
- 检查条目是否已删除
**预期结果**: 条目成功删除，条目数减少1

### 10. 保存文件
**目的**: 测试保存到文件功能
**步骤**:
- 点击"另存为"按钮
- 在文件对话框中设置保存路径
- 等待保存完成
- 检查文件是否创建
- 检查文件内容格式
**预期结果**: 文件成功创建，包含正确的 JSON 数据

### 11. 打开文件
**目的**: 测试从文件加载功能
**步骤**:
- 创建测试 JSON 文件
- 点击"打开"按钮
- 在文件对话框中选择测试文件
- 等待加载完成
- 检查数据是否正确加载
**预期结果**: 文件中的数据正确加载到应用中

### 12. 撤销操作
**目的**: 测试撤销功能
**步骤**:
- 记录操作前的条目数
- 添加一个新条目
- 检查条目是否添加
- 点击"撤销"按钮
- 检查是否撤销成功
**预期结果**: 条目数恢复到操作前的状态

### 13. 重做操作
**目的**: 测试重做功能
**步骤**:
- 添加一个新条目
- 撤销操作
- 点击"重复"按钮
- 检查是否重做成功
**预期结果**: 条目数恢复到撤销前的状态

### 14. 搜索导航
**目的**: 测试搜索结果导航功能
**步骤**:
- 添加包含多个匹配的测试数据
- 搜索 "test"
- 检查搜索结果数量
- 点击"下一个"按钮
- 检查当前高亮
**预期结果**: 能够在多个匹配结果之间导航

### 15. 批量导入
**目的**: 测试批量导入功能
**步骤**:
- 创建测试 JSON 文件
- 点击批量导入按钮
- 在文件对话框中选择测试文件
- 等待导入完成
- 检查条目是否导入
- 检查导入的条目内容
**预期结果**: 所有条目成功导入，内容正确

## 运行测试

### 快速开始
```bash
npm test
```

### 有界面模式
```bash
npm run test:headed
```

### Playwright UI
```bash
npm run test:ui
```

### 调试模式
```bash
npm run test:debug
```

## 查看报告

```bash
npm run test:show-report
```

## 注意事项

1. **临时文件**: 测试会在 `temp` 目录下创建临时文件，测试完成后会自动清理
2. **独立运行**: 运行测试时请确保没有其他 Electron 实例在运行
3. **执行时间**: 某些测试可能需要较长时间，请耐心等待
4. **网络依赖**: 测试不需要网络连接，完全在本地运行

## 扩展测试

要添加新的测试用例，在 `tests/electron.spec.js` 中添加新的测试函数：

```javascript
test('新测试用例', async () => {
  // 测试步骤
  await window.click('button');
  await window.fill('input', 'text');
  
  // 验证结果
  await expect(element).toBeVisible();
});
```

## 常见问题

**Q: 测试失败怎么办？**
A: 运行 `npm run test:headed` 查看实际执行过程，或运行 `npm run test:debug` 进入调试模式。

**Q: 如何只运行特定测试？**
A: 使用 `--grep` 参数：`npm test --grep "搜索功能"`

**Q: 测试报告在哪里？**
A: 测试报告在 `playwright-report` 目录下，运行 `npm run test:show-report` 查看。

**Q: 如何更新 Playwright？**
A: 运行 `npm install --save-dev @playwright/test@latest`